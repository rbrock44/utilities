<div class="gold-reference">
  <div class="header">
    <h2>Gold Coin Reference Guide</h2>
    @if (spotPrices && !loading && spotPrices.gold > 0) {
    <div class="spot-price">
      <span class="label">Gold Spot:</span>
      <span class="price">${{ spotPrices.gold.toFixed(2) }}/toz</span>
      <span class="timestamp">{{ spotPrices.timestamp | date:'short' }}</span>
    </div>
    }
    @if (loading) {
    <div class="loading">Loading prices...</div>
    }
    @if (!loading && (!spotPrices || spotPrices.gold <= 0)) { <div class="error">
      Unable to load spot prices. Values will not be displayed.
  </div>
  }
</div>

<!-- Filter/Search -->
<div class="controls">
  <input type="text" [(ngModel)]="searchTerm" (input)="filterCoins()" placeholder="Search coins..."
    class="search-input">
  <select [(ngModel)]="filterPurity" (change)="filterCoins()" class="filter-select">
    <option value="all">All Gold Content</option>
    <option value="0.9999">99.99% (24K Bullion)</option>
    <option value="0.999">99.9% (Panda)</option>
    <option value="0.9860">98.6% (Ducat)</option>
    <option value="0.9167">91.67% (22K - Eagle/Krugerrand)</option>
    <option value="0.900">90% (US/Mexican Historic)</option>
  </select>
</div>

<!-- Mobile Card View -->
<div class="mobile-view">
  <div class="coin-card" *ngFor="let coin of filteredCoins">
    <div class="coin-header">
      <h3>{{ coin.name }}</h3>
      <span class="gold-badge" [class.no-gold]="coin.purity === 0">
        {{ coin.purity * 100 }}% Gold
      </span>
    </div>
    <div class="coin-details">
      <p class="description">{{ coin.description }}</p>
      <div class="specs">
        <div class="spec-row">
          <span class="label">Weight:</span>
          <span class="value">{{ coin.weightGrams.toFixed(2) }}g</span>
        </div>
        @if (coin.purity > 0) {
        <div class="spec-row">
          <span class="label">Pure Gold:</span>
          <span class="value">{{ coin.pureGrams.toFixed(2) }}g ({{ coin.pureToz.toFixed(3) }} toz)</span>
        </div>
        }
      </div>
      @if (shouldShowValue(coin)) {
      <div class="values">
        <div class="value-row spot">
          <span class="label">Spot Value:</span>
          <span class="amount">${{ coin.spotValue.toFixed(2) }}</span>
        </div>
        <div class="value-row good">
          <span class="label">Good Deal (90%):</span>
          <span class="amount">${{ coin.value90.toFixed(2) }}</span>
        </div>
        <div class="value-row great">
          <span class="label">Great Deal (80%):</span>
          <span class="amount">${{ coin.value80.toFixed(2) }}</span>
        </div>
      </div>
      }
      @if (coin.purity === 0) {
      <div class="no-gold-msg">
        <em>No gold content - collectible value only</em>
      </div>
      }
    </div>
  </div>
</div>

<!-- Desktop Table View -->
<div class="desktop-view">
  <div class="table-wrapper">
    <table class="coin-table">
      <thead>
        <tr>
          <th (click)="sortBy('name')" class="sortable col-name">
            Coin {{ getSortIcon('name') }}
          </th>
          <th class="col-description">Description</th>
          <th (click)="sortBy('weightGrams')" class="sortable text-right col-weight">
            Wt (g) {{ getSortIcon('weightGrams') }}
          </th>
          <th (click)="sortBy('purity')" class="sortable text-center col-purity">
            Ag% {{ getSortIcon('purity') }}
          </th>
          <th class="text-right col-oz">Toz %</th>
          <th (click)="sortBy('spotValue')" class="sortable text-right col-value">
            Spot {{ getSortIcon('spotValue') }}
          </th>
          <th class="text-right col-value good-deal">90%</th>
          <th class="text-right col-value great-deal">80%</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let coin of filteredCoins" [class.no-gold-row]="coin.purity === 0">
          <td class="coin-name">{{ coin.name }}</td>
          <td class="description">{{ coin.description }}</td>
          <td class="text-right">{{ coin.weightGrams.toFixed(2) }}</td>
          <td class="text-center">
            <span class="gold-badge" [class.no-gold]="coin.purity === 0">
              {{ (coin.purity * 100).toFixed(1) }}%
            </span>
          </td>
          <td class="text-right">
            @if (coin.purity > 0) {
            <span>{{ coin.pureToz.toFixed(4) }}</span>
            }
            @if (coin.purity === 0) {
            <span class="no-gold">—</span>
            }
          </td>
          <td class="text-right spot-value">
            @if (shouldShowValue(coin)) {
            <span>
              ${{ coin.spotValue.toFixed(2) }}
            </span>
            } @else {
            <span class="no-gold">
              —
            </span>
            }
          </td>
          <td class="text-right good-deal">
            @if (shouldShowValue(coin)) {
            <span>
              ${{ coin.value90.toFixed(2) }}
            </span>
            } @else {
            <span class="no-gold">
              —
            </span>
            }
          </td>
          <td class="text-right great-deal">
            @if (shouldShowValue(coin)) {
            <span>
              ${{ coin.value80.toFixed(2) }}
            </span>
            } @else {
            <span class="no-gold">
              —
            </span>
            }
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>