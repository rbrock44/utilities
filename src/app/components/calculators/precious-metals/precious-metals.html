<div class="calculator-container">
  <div class="header">
    <h2>Precious Metals Calculator</h2>
    <button class="refresh-btn" (click)="loadSpotPrices()" [disabled]="loading">
      {{ loading ? 'Loading...' : 'Refresh Prices' }}
    </button>
  </div>

  @if (spotPrices) {
  <div class="spot-prices">
    <div class="spot-price-card">
      <span class="metal-name">Gold</span>
      <span class="price">${{ spotPrices.gold.toFixed(2) }}/oz</span>
    </div>
    <div class="spot-price-card">
      <span class="metal-name">Silver</span>
      <span class="price">${{ spotPrices.silver.toFixed(2) }}/oz</span>
    </div>
    <div class="timestamp">
      Updated: {{ spotPrices.timestamp | date:'short' }}
    </div>
  </div>
  }

  <!-- GOLD SECTION -->
  <div class="metal-section">
    <div class="section-header">
      <h3>ðŸ¥‡ Gold</h3>
      <button class="add-btn" (click)="addGoldRow()">+ Add Row</button>
    </div>

    <div class="rows-container">
      <div class="row" *ngFor="let row of goldRows">
        <select [(ngModel)]="row.type" class="type-select">
          <option *ngFor="let type of goldMetalTypes" [value]="type.name">
            {{ type.name }}
          </option>
        </select>

        <input type="number" [(ngModel)]="row.weight" placeholder="Weight" class="weight-input" step="0.01" min="0">

        <select [(ngModel)]="row.unit" class="unit-select">
          <option value="grams">g</option>
          <option value="toz">oz t</option>
        </select>

        <button class="remove-btn" (click)="removeGoldRow(row.id)" [disabled]="goldRows.length === 1">
          Ã—
        </button>
      </div>
    </div>

    <app-precious-metal-breakdown [title]="'Gold Breakdown'" [breakdowns]="goldBreakdowns" [totals]="goldTotals"
      totalsTitle="Gold Totals" totalsClass="gold-totals">
    </app-precious-metal-breakdown>
  </div>

  <!-- SILVER SECTION -->
  <div class="metal-section">
    <div class="section-header">
      <h3>âšª Silver</h3>
      <button class="add-btn" (click)="addSilverRow()">+ Add Row</button>
    </div>

    <div class="rows-container">
      <div class="row" *ngFor="let row of silverRows">
        <select [(ngModel)]="row.type" class="type-select">
          <option *ngFor="let type of silverMetalTypes" [value]="type.name">
            {{ type.name }}
          </option>
        </select>

        <input type="number" [(ngModel)]="row.weight" placeholder="Weight" class="weight-input" step="0.01" min="0">

        <select [(ngModel)]="row.unit" class="unit-select">
          <option value="grams">g</option>
          <option value="toz">oz t</option>
        </select>

        <button class="remove-btn" (click)="removeSilverRow(row.id)" [disabled]="silverRows.length === 1">
          Ã—
        </button>
      </div>
    </div>

    <app-precious-metal-breakdown [title]="'Silver Breakdown'" [breakdowns]="silverBreakdowns" [totals]="silverTotals"
      totalsTitle="Silver Totals" totalsClass="silver-totals">
    </app-precious-metal-breakdown>
  </div>

  <!-- CALCULATE BUTTON -->
  <button class="calculate-btn" (click)="calculate()" [disabled]="!spotPrices">
    Calculate Values
  </button>

  <!-- GRAND TOTALS -->
  @if (grandTotals.spotValue > 0) {
  <div class="grand-totals" *ngIf="grandTotals.spotValue > 0">
    <h3>Combined Totals</h3>
    <div class="detail-row highlight large">
      <span>Total Spot Value:</span>
      <span>${{ grandTotals.spotValue.toFixed(2) }}</span>
    </div>
    <div class="detail-row large">
      <span>Total 90% Value:</span>
      <span>${{ grandTotals.value90.toFixed(2) }}</span>
    </div>
    <div class="detail-row large">
      <span>Total 80% Value:</span>
      <span>${{ grandTotals.value80.toFixed(2) }}</span>
    </div>
    <div class="detail-row large">
      <span>Total 70% Value:</span>
      <span>${{ grandTotals.value70.toFixed(2) }}</span>
    </div>
  </div>
  }
</div>